// Generated by CoffeeScript 1.4.0
var Adaptor, SocketIoAdaptor, SocketIoEdge, io;

io = require('socket.io');

Adaptor = require('../adaptor');

SocketIoEdge = require('../edges/socket.io-edge');

SocketIoAdaptor = (function() {

  function SocketIoAdaptor() {}

  SocketIoAdaptor.listen = function(opts, onConnect) {
    var server, _adaptor,
      _this = this;
    this.opts = opts;
    Adaptor.validate(this.opts, onConnect);
    if (!(this.opts.listen && this.opts.listen.port)) {
      throw 'undefined opts.port';
    }
    _adaptor = this;
    server = io.listen(this.opts.listen.port, function() {
      if (_this.opts.listen.onListen) {
        return _this.opts.listen.onListen(_adaptor);
      }
    });
    server.on('connection', function(socket) {
      var edge;
      edge = new SocketIoEdge(socket, _this.opts);
      if (_this.opts.onConnect) {
        _this.opts.listen.onConnect(edge);
      }
      return onConnect(edge);
    });
    return server;
  };

  return SocketIoAdaptor;

})();

module.exports = SocketIoAdaptor;
